document.addEventListener("DOMContentLoaded",async function(){showPageBtn();const imageData=await loadPicture();const itemsPerPage=10;let currentImages=imageData?imageData.slice():imageData;let totalPages=Math.ceil(currentImages.length/itemsPerPage);let mobileCurrentPage=1;function displayImages(currentPage){const startIndex=(currentPage-1)*itemsPerPage;const endIndex=startIndex+itemsPerPage;const pageImages=currentImages.slice(startIndex,endIndex);const gallery=document.querySelector(".image-gallery");while(gallery.firstChild){gallery.removeChild(gallery.firstChild)}pageImages.forEach(el=>{const imageItem=document.createElement("div");imageItem.classList.add("image-item");const loadingElement=document.createElement("div");loadingElement.classList.add("image-loading");loadingElement.textContent="Loading...";loadingElement.style.display="block";const alink=document.createElement("a");alink.href=el.detail_url;alink.target="_blank";alink.rel="noopener noreferrer nofollow";const img=new Image;img.alt=el.title;img.title=el.title;img.src=el.url;loadImage(el.url,function(){loadingElement.style.display="none"});alink.appendChild(img);imageItem.appendChild(alink);imageItem.appendChild(loadingElement);gallery.appendChild(imageItem)});const currentPageElement=document.getElementById("currentPage");currentPageElement.textContent=currentPage;const totalpageElement=document.getElementById("totalpage");totalpageElement.textContent=totalPages}const modeIcon=document.querySelector(".icon");modeIcon.addEventListener("click",function(){document.body.classList.toggle("night-mode");if(document.body.classList.contains("night-mode")){modeIcon.src="asset/icons/sun.png"}else{modeIcon.src="asset/icons/moon.png"}});const searchButton=document.getElementById("searchButton");const searchInput=document.getElementById("searchInput");searchInput.addEventListener("keydown",function(event){if(event.key==="Enter"){performSearch()}});searchButton.addEventListener("click",performSearch);function performSearch(){const searchTerm=searchInput.value.toLowerCase();if(!searchTerm.trim()){currentImages=imageData.slice()}else{currentImages=imageData.filter(item=>item.title.toLowerCase().includes(searchTerm)||item.id.toLowerCase().includes(searchTerm))}totalPages=Math.ceil(currentImages.length/itemsPerPage);mobileCurrentPage=1;displayImages(1)}const firstPageButton=document.getElementById("firstPage");firstPageButton.addEventListener("click",function(){displayImages(1)});const prevPageButton=document.getElementById("prevPage");prevPageButton.addEventListener("click",function(){const currentPage=parseInt(document.getElementById("currentPage").textContent);if(currentPage>1){displayImages(currentPage-1)}});const nextPageButton=document.getElementById("nextPage");nextPageButton.addEventListener("click",function(){const currentPage=parseInt(document.getElementById("currentPage").textContent);const totalPages=Math.ceil(currentImages.length/itemsPerPage);if(currentPage<totalPages){displayImages(currentPage+1)}});const lastPageButton=document.getElementById("lastPage");lastPageButton.addEventListener("click",function(){displayImages(totalPages)});const currentPageElement=document.getElementById("currentPage");currentPageElement.addEventListener("input",function(event){let currentPage;try{currentPage=parseInt(event.target.textContent)}catch(e){currentPage=1}if(isNaN(currentPage)){currentPage=1}else if(currentPage<1){currentPage=1}else if(currentPage>totalPages){currentPage=totalPages}displayImages(currentPage)});const loadMoreBtn=document.getElementById("loadMoreBtn");loadMoreBtn.addEventListener("click",function(){mobileCurrentPage++;const startIndex=(mobileCurrentPage-1)*itemsPerPage;const endIndex=startIndex+itemsPerPage;const pageImages=currentImages.slice(startIndex,endIndex);const gallery=document.querySelector(".image-gallery");pageImages.forEach(el=>{const imageItem=document.createElement("div");imageItem.classList.add("image-item");const loadingElement=document.createElement("div");loadingElement.classList.add("image-loading");loadingElement.textContent="Loading...";loadingElement.style.display="block";const alink=document.createElement("a");alink.href=el.detail_url;alink.target="_blank";alink.rel="noopener noreferrer nofollow";const img=new Image;img.alt=el.title;img.title=el.title;img.src=el.url;loadImage(el.url,function(){loadingElement.style.display="none"});alink.appendChild(img);imageItem.appendChild(alink);imageItem.appendChild(loadingElement);gallery.appendChild(imageItem)});if(itemsPerPage>pageImages.length){loadMoreBtn.style.display="none"}});const scrollTopBtn=document.getElementById("scrollTopBtn");window.addEventListener("scroll",function(){if(window.scrollY>200){scrollTopBtn.classList.add("show")}else{scrollTopBtn.classList.remove("show")}});scrollTopBtn.addEventListener("click",function(){window.scrollTo({top:0,behavior:"smooth"})});await loadLanguage();displayImages(1)});function loadImage(src,callback){const img=new Image;img.onload=function(){callback(img)};img.src=src}function toggleNightMode(){document.body.classList.toggle("night-mode")}async function loadPicture(){try{const response=await fetch(`raw/datas.json`);const datas=await response.json();if(!datas){datas=[]}return datas}catch(e){console.log(e)}}async function loadLanguage(){let userLanguage=navigator.language||navigator.userLanguage;if(userLanguage!=="en"&&userLanguage!=="zh-CN"&&userLanguage!=="ja"){userLanguage="en"}let html=document.getElementsByTagName("html");html[0].lang=userLanguage;try{const response=await fetch(`asset/lang/${userLanguage}.json`);const data=await response.json();document.getElementById("homeLink").textContent=data.home;document.getElementById("aboutLink").textContent=data.about;document.getElementById("searchButton").textContent=data.search;document.getElementById("firstPage").textContent=data.first_page;document.getElementById("prevPage").textContent=data.prev_page;document.getElementById("nextPage").textContent=data.next_page;document.getElementById("lastPage").textContent=data.last_page}catch(e){console.log(e)}}function showPageBtn(){if(isMobile()){const pagination=document.querySelector(".pagination-container");pagination.style.display="none";const mobilePagination=document.querySelector(".mobile-pagination-container");mobilePagination.style.display="block"}else{const pagination=document.querySelector(".pagination-container");pagination.style.display="flex";const mobilePagination=document.querySelector(".mobile-pagination-container");mobilePagination.style.display="none"}}function isMobile(){var userAgent=navigator.userAgent;var mobileDeviceRegex=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i;if(mobileDeviceRegex.test(userAgent)||window.matchMedia("only screen and (max-width: 768px)").matches){return true}return false}